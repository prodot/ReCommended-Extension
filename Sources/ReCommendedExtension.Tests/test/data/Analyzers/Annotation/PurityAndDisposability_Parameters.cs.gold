using System;
using System.IO;
using System.Threading.Tasks;
using JetBrains.Annotations;

namespace Test
{
    [method: MustDisposeResource]
    internal ref struct |DisposableRefStruct|(0)()
    {
        public void Dispose() { }
    }

    internal class Parent
    {
        public virtual void NotAnnotated(ref IDisposable |p0|(1), out IAsyncDisposable |p1|(2)) => throw new NotImplementedException();

        public virtual void Annotated([MustDisposeResource] ref Stream p0, [MustDisposeResource] out DisposableRefStruct p1) => throw new NotImplementedException();

        public virtual void AnnotatedWithFalse([MustDisposeResource(false)] ref Stream p0, [MustDisposeResource(false)] out DisposableRefStruct p1) => throw new NotImplementedException();
    }

    internal class Child : Parent
    {
        public override void NotAnnotated(ref IDisposable |p0|(3), out IAsyncDisposable |p1|(4)) => throw new NotImplementedException();

        public override void Annotated(ref Stream p0, out DisposableRefStruct p1) => throw new NotImplementedException();

        public override void AnnotatedWithFalse(ref Stream |p0|(5), out DisposableRefStruct |p1|(6)) => throw new NotImplementedException();

        public void Other(ref IDisposable |p0|(7), out DisposableRefStruct |p1|(8)) => throw new NotImplementedException();
    }

    internal class Child2 : Parent
    {
        public override void NotAnnotated(ref IDisposable |p0|(9), out IAsyncDisposable |p1|(10)) => throw new NotImplementedException();

        public override void Annotated([|MustDisposeResource|(11)] ref Stream p0, [|MustDisposeResource|(12)] out DisposableRefStruct p1) => throw new NotImplementedException();

        public override void AnnotatedWithFalse([MustDisposeResource(false)] ref Stream p0, [MustDisposeResource(false)] out DisposableRefStruct p1) => throw new NotImplementedException();
    }

    internal class ParentTaskLike
    {
        public virtual void NotAnnotated(ref ValueTask<IDisposable> |p0|(13), out Task<IAsyncDisposable> |p1|(14)) => throw new NotImplementedException();

        public virtual void Annotated([MustDisposeResource] ref ValueTask<Stream> p0, [MustDisposeResource] out Task<IDisposable> p1) => throw new NotImplementedException();

        public virtual void AnnotatedWithFalse([MustDisposeResource(false)] ref ValueTask<Stream> p0, [MustDisposeResource(false)] out Task<IAsyncDisposable> p1) => throw new NotImplementedException();
    }

    internal class ChildTaskLike : ParentTaskLike
    {
        public override void NotAnnotated(ref ValueTask<IDisposable> |p0|(15), out Task<IAsyncDisposable> |p1|(16)) => throw new NotImplementedException();

        public override void Annotated(ref ValueTask<Stream> p0, out Task<IDisposable> p1) => throw new NotImplementedException();

        public override void AnnotatedWithFalse(ref ValueTask<Stream> |p0|(17), out Task<IAsyncDisposable> |p1|(18)) => throw new NotImplementedException();

        public void Other(ref Task<IDisposable> |p0|(19), out ValueTask<Stream> |p1|(20)) => throw new NotImplementedException();
    }

    internal class Other
    {
        public void InputParameters([|MustDisposeResource|(21)] IDisposable p0, [|MustDisposeResource|(22)] in IDisposable p1, [|MustDisposeResource|(23)] ref readonly IDisposable p2) { }

        public void NonDisposable([|MustDisposeResource|(24)] ref int p0, [|MustDisposeResource|(25)] out int p1) => throw new NotImplementedException();
    }
}
---------------------------------------------------------
(0): ReSharper Warning: Struct is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(1): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(2): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(3): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(4): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(5): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(6): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(7): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(8): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(9): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(10): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(11): ReSharper Suggestion: Annotation is redundant because the parameter of a base method is already annotated with [MustDisposeResource].
(12): ReSharper Suggestion: Annotation is redundant because the parameter of a base method is already annotated with [MustDisposeResource].
(13): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(14): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(15): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(16): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(17): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(18): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(19): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(20): ReSharper Warning: Parameter is disposable, but not annotated with [MustDisposeResource] or [MustDisposeResource(false)].
(21): ReSharper Warning: Meaningless [MustDisposeResource] annotation for an input parameter
(22): ReSharper Warning: Meaningless [MustDisposeResource] annotation for an input parameter
(23): ReSharper Warning: Meaningless [MustDisposeResource] annotation for an input parameter
(24): ReSharper Warning: Annotation is not valid because the parameter is not disposable.
(25): ReSharper Warning: Annotation is not valid because the parameter is not disposable.
